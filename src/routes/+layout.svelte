<script lang="ts">  
    import "../app.css";
    import { onMount } from "svelte";
    import { langPreference } from "./stores.svelte";
    import { page } from "$app/state";
    let { children } = $props();
    
    function getLangPref(): void {
        if(!langPreference.lang){
            console.log('langPreference is not set yet, this is the first loading')
            if(!page.data.langPref) {
                // Get lang preference from Navigator
                langPreference.lang = navigator.languages[0].toLowerCase().includes('ar') ? 'ar' : 'en'
                // Set cookie
                document.cookie = `lang=${navigator.languages[0].toLowerCase().includes('ar') ? 'ar' : 'en'}; max-age=31536000; path=/`

                console.log('langPref doesn\'t exist in cookies nor langPreference.lang, getting data from navigator', `::${page.data.langPref}::`)
            } else {
                // Get lang preference from cookies
                langPreference.lang = page.data.langPref
                console.log('langPref exists in cookies, getting data from cookies', `::${page.data.langPref}::`)
            }
        }
    }
    function changeLangPref(lang: "ar" | "en"): void {
        langPreference.lang = lang
        document.cookie = `lang=${lang}; max-age=31536000; path=/`
    }
    onMount(getLangPref)
    
    let isCurrentLangAr = $derived(langPreference.lang == 'ar')
    let screenWidth = $state(0)
</script>
<svelte:body bind:clientWidth={screenWidth} />
<nav class="sticky top-0 z-10 h-16 py-8 w-full flex justify-center border-b border-gray-300 bg-white/80 backdrop-blur-sm">
    <div class="w-9/10 h-full flex justify-between items-center">
        <!-- Logo -->
        <div class="">
            <svg class="h-20" viewBox={ screenWidth < 1050 ? "0 0 300 181" : "0 0 694 181"} fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M51.73 71.4V119.07H47.88L14.63 77V112.56L21.98 116.27L20.58 119.07H4.2V116.9L10.78 111.72V70.7L3.5 66.78L4.9 63.98H15.47L47.88 105V70.42L40.6 66.78L42 63.98H58.38V66.22L51.73 71.4ZM96.1816 62.58C101.128 62.58 105.492 63.77 109.272 66.15C113.098 68.53 116.062 71.82 118.162 76.02C120.262 80.22 121.312 84.98 121.312 90.3C121.312 95.76 119.725 100.8 116.552 105.42C113.378 110.04 109.435 113.703 104.722 116.41C100.008 119.07 95.505 120.4 91.2116 120.4C86.265 120.4 81.8783 119.233 78.0516 116.9C74.2716 114.52 71.3316 111.23 69.2316 107.03C67.1316 102.83 66.0816 98.07 66.0816 92.75C66.0816 87.29 67.6683 82.25 70.8416 77.63C74.015 72.9633 77.9583 69.3 82.6716 66.64C87.385 63.9333 91.8883 62.58 96.1816 62.58ZM92.1216 68.46C89.0416 68.46 86.2183 69.37 83.6516 71.19C81.1316 72.9633 79.1483 75.46 77.7016 78.68C76.255 81.8533 75.5316 85.4233 75.5316 89.39C75.5316 93.9633 76.255 98.1633 77.7016 101.99C79.1483 105.77 81.3416 108.803 84.2816 111.09C87.2683 113.377 90.9316 114.52 95.2716 114.52C98.3516 114.52 101.152 113.633 103.672 111.86C106.238 110.04 108.245 107.543 109.692 104.37C111.138 101.15 111.862 97.5567 111.862 93.59C111.862 88.97 111.138 84.77 109.692 80.99C108.245 77.1633 106.052 74.13 103.112 71.89C100.172 69.6033 96.5083 68.46 92.1216 68.46ZM165.671 89.39C169.265 90.4167 172.088 92.1433 174.141 94.57C176.195 96.9967 177.221 99.7967 177.221 102.97C177.221 105.91 176.031 108.687 173.651 111.3C171.318 113.867 168.378 115.92 164.831 117.46C161.331 119 157.995 119.77 154.821 119.77C152.488 119.77 150.201 119.653 147.961 119.42C144.228 119.187 141.335 119.07 139.281 119.07H130.391V116.9L136.971 111.72V69.16L129.691 66.78L131.091 63.98H139.211C143.458 63.98 147.635 63.84 151.741 63.56C154.915 63.3733 157.248 63.28 158.741 63.28C161.868 63.28 164.621 63.8867 167.001 65.1C169.381 66.3133 171.201 67.97 172.461 70.07C173.768 72.1233 174.421 74.4333 174.421 77C174.421 79.3333 173.605 81.5733 171.971 83.72C170.385 85.82 168.285 87.6633 165.671 89.25V89.39ZM164.971 80.5C164.971 76.8133 163.991 73.8033 162.031 71.47C160.071 69.1367 157.155 67.97 153.281 67.97C150.481 67.97 147.961 68.7633 145.721 70.35V88.9H155.731C158.625 88.9 160.888 88.1767 162.521 86.73C164.155 85.2367 164.971 83.1367 164.971 80.43V80.5ZM156.781 114.66C160.141 114.66 162.801 113.82 164.761 112.14C166.768 110.46 167.771 108.197 167.771 105.35C167.771 101.71 166.698 98.77 164.551 96.53C162.451 94.29 159.301 93.1 155.101 92.96C154.775 93.0067 154.331 93.03 153.771 93.03H145.721V112.84C148.848 114.1 152.535 114.73 156.781 114.73V114.66ZM227.626 119H185.626V116.83L192.206 111.65V69.23L184.926 66.78L186.326 63.98H207.606V66.15L200.956 71.33V115.85H219.016L229.306 100.66L231.406 101.36V120.26L227.626 119ZM282.518 119H240.518V116.83L247.098 111.65V69.23L239.818 66.78L241.218 63.98H281.818L285.598 62.72V78.82L283.498 79.52L275.168 67.13H255.848V89.32H266.838L271.948 80.36H274.118V101.64L271.318 103.04L266.908 92.47H255.848V115.85H274.888L284.198 102.06L286.298 102.76V120.26L282.518 119Z" fill="#0369a0"/>
                <path class="hidden min-[1050px]:block" d="M353.062 84H346.554V62.9091H353.351C355.397 62.9091 357.147 63.3313 358.603 64.1758C360.058 65.0134 361.174 66.2183 361.95 67.7905C362.726 69.3558 363.114 71.2301 363.114 73.4134C363.114 75.6103 362.722 77.5018 361.94 79.0877C361.157 80.6668 360.017 81.882 358.521 82.7333C357.024 83.5778 355.205 84 353.062 84ZM349.108 81.7344H352.898C354.642 81.7344 356.087 81.398 357.233 80.7251C358.38 80.0523 359.235 79.0946 359.798 77.8519C360.361 76.6093 360.642 75.1297 360.642 73.4134C360.642 71.7107 360.364 70.2449 359.808 69.016C359.252 67.7802 358.421 66.8327 357.316 66.1736C356.21 65.5077 354.834 65.1747 353.186 65.1747H349.108V81.7344ZM372.328 84V62.9091H385.056V65.1747H374.882V72.3011H384.397V74.5668H374.882V81.7344H385.221V84H372.328ZM411.314 62.9091V84H408.843L397.35 67.4403H397.144V84H394.59V62.9091H397.061L408.595 79.5099H408.801V62.9091H411.314ZM420.201 65.1747V62.9091H436.019V65.1747H429.387V84H426.833V65.1747H420.201ZM443.292 84H440.615L448.359 62.9091H450.995L458.74 84H456.062L449.76 66.2457H449.595L443.292 84ZM444.281 75.7614H455.074V78.027H444.281V75.7614ZM466.955 84V62.9091H469.509V81.7344H479.313V84H466.955ZM500.13 65.1747V62.9091H515.948V65.1747H509.316V84H506.762V65.1747H500.13ZM524.82 84V62.9091H531.947C533.594 62.9091 534.947 63.1906 536.004 63.7536C537.061 64.3097 537.844 65.0752 538.352 66.0501C538.86 67.025 539.114 68.1338 539.114 69.3764C539.114 70.6191 538.86 71.721 538.352 72.6822C537.844 73.6433 537.065 74.3986 536.014 74.9478C534.964 75.4902 533.622 75.7614 531.988 75.7614H526.221V73.4545H531.905C533.031 73.4545 533.938 73.2898 534.624 72.9602C535.318 72.6307 535.819 72.1638 536.128 71.5597C536.443 70.9486 536.601 70.2209 536.601 69.3764C536.601 68.532 536.443 67.7939 536.128 67.1623C535.812 66.5307 535.307 66.0432 534.614 65.6999C533.92 65.3498 533.004 65.1747 531.864 65.1747H527.374V84H524.82ZM534.748 74.5256L539.938 84H536.972L531.864 74.5256H534.748ZM549.165 84H546.487L554.232 62.9091H556.868L564.612 84H561.935L555.632 66.2457H555.468L549.165 84ZM550.154 75.7614H560.946V78.027H550.154V75.7614ZM575.382 62.9091V84H572.828V62.9091H575.382ZM602.157 62.9091V84H599.685L588.192 67.4403H587.986V84H585.432V62.9091H587.904L599.438 79.5099H599.644V62.9091H602.157ZM614.751 62.9091V84H612.197V62.9091H614.751ZM641.527 62.9091V84H639.055L627.562 67.4403H627.356V84H624.802V62.9091H627.274L638.808 79.5099H639.014V62.9091H641.527ZM665.985 69.5C665.758 68.8066 665.46 68.1853 665.089 67.636C664.725 67.0799 664.289 66.6062 663.781 66.2148C663.28 65.8235 662.71 65.5249 662.071 65.3189C661.433 65.1129 660.733 65.0099 659.971 65.0099C658.721 65.0099 657.585 65.3326 656.562 65.978C655.539 66.6233 654.725 67.5742 654.121 68.8306C653.517 70.087 653.215 71.6283 653.215 73.4545C653.215 75.2808 653.52 76.8221 654.131 78.0785C654.742 79.3349 655.57 80.2857 656.613 80.9311C657.657 81.5765 658.831 81.8991 660.135 81.8991C661.344 81.8991 662.408 81.6417 663.328 81.1268C664.255 80.605 664.976 79.8704 665.49 78.9229C666.012 77.9686 666.273 76.8461 666.273 75.5554L667.056 75.7202H660.712V73.4545H668.745V75.7202C668.745 77.4571 668.374 78.9676 667.632 80.2514C666.898 81.5353 665.882 82.5308 664.584 83.2379C663.293 83.9382 661.811 84.2884 660.135 84.2884C658.268 84.2884 656.627 83.849 655.213 82.9702C653.805 82.0914 652.707 80.8419 651.917 79.2216C651.135 77.6013 650.743 75.679 650.743 73.4545C650.743 71.7862 650.966 70.2861 651.413 68.9542C651.866 67.6154 652.504 66.4757 653.328 65.5352C654.152 64.5946 655.127 63.8737 656.253 63.3725C657.379 62.8713 658.618 62.6207 659.971 62.6207C661.083 62.6207 662.119 62.7889 663.081 63.1254C664.049 63.4549 664.91 63.9252 665.665 64.5362C666.428 65.1404 667.063 65.8647 667.571 66.7092C668.079 67.5468 668.429 68.477 668.621 69.5H665.985ZM363.526 104.5H360.972C360.821 103.765 360.556 103.12 360.179 102.564C359.808 102.008 359.355 101.541 358.819 101.163C358.291 100.779 357.704 100.491 357.058 100.298C356.413 100.106 355.74 100.01 355.04 100.01C353.763 100.01 352.606 100.333 351.569 100.978C350.539 101.623 349.719 102.574 349.108 103.831C348.504 105.087 348.202 106.628 348.202 108.455C348.202 110.281 348.504 111.822 349.108 113.078C349.719 114.335 350.539 115.286 351.569 115.931C352.606 116.576 353.763 116.899 355.04 116.899C355.74 116.899 356.413 116.803 357.058 116.611C357.704 116.419 358.291 116.134 358.819 115.756C359.355 115.372 359.808 114.901 360.179 114.345C360.556 113.782 360.821 113.137 360.972 112.409H363.526C363.333 113.487 362.983 114.452 362.475 115.303C361.967 116.154 361.335 116.879 360.58 117.476C359.825 118.066 358.977 118.516 358.037 118.825C357.103 119.134 356.104 119.288 355.04 119.288C353.241 119.288 351.641 118.849 350.241 117.97C348.84 117.091 347.738 115.842 346.935 114.222C346.132 112.601 345.73 110.679 345.73 108.455C345.73 106.23 346.132 104.308 346.935 102.688C347.738 101.067 348.84 99.8177 350.241 98.9389C351.641 98.0601 353.241 97.6207 355.04 97.6207C356.104 97.6207 357.103 97.7752 358.037 98.0842C358.977 98.3931 359.825 98.8462 360.58 99.4435C361.335 100.034 361.967 100.755 362.475 101.606C362.983 102.451 363.333 103.415 363.526 104.5ZM390.378 108.455C390.378 110.679 389.976 112.601 389.173 114.222C388.37 115.842 387.268 117.091 385.867 117.97C384.467 118.849 382.867 119.288 381.068 119.288C379.27 119.288 377.67 118.849 376.269 117.97C374.869 117.091 373.767 115.842 372.964 114.222C372.16 112.601 371.759 110.679 371.759 108.455C371.759 106.23 372.16 104.308 372.964 102.688C373.767 101.067 374.869 99.8177 376.269 98.9389C377.67 98.0601 379.27 97.6207 381.068 97.6207C382.867 97.6207 384.467 98.0601 385.867 98.9389C387.268 99.8177 388.37 101.067 389.173 102.688C389.976 104.308 390.378 106.23 390.378 108.455ZM387.906 108.455C387.906 106.628 387.601 105.087 386.99 103.831C386.386 102.574 385.565 101.623 384.529 100.978C383.499 100.333 382.345 100.01 381.068 100.01C379.791 100.01 378.635 100.333 377.598 100.978C376.568 101.623 375.748 102.574 375.137 103.831C374.532 105.087 374.23 106.628 374.23 108.455C374.23 110.281 374.532 111.822 375.137 113.078C375.748 114.335 376.568 115.286 377.598 115.931C378.635 116.576 379.791 116.899 381.068 116.899C382.345 116.899 383.499 116.576 384.529 115.931C385.565 115.286 386.386 114.335 386.99 113.078C387.601 111.822 387.906 110.281 387.906 108.455ZM399.602 97.9091H402.651L409.818 115.416H410.066L417.233 97.9091H420.281V119H417.892V102.976H417.686L411.095 119H408.789L402.198 102.976H401.992V119H399.602V97.9091ZM430.332 119V97.9091H437.459C439.113 97.9091 440.466 98.2077 441.516 98.805C442.574 99.3955 443.356 100.195 443.864 101.205C444.372 102.214 444.626 103.34 444.626 104.582C444.626 105.825 444.372 106.954 443.864 107.971C443.363 108.987 442.587 109.797 441.537 110.401C440.486 110.998 439.141 111.297 437.5 111.297H432.392V109.031H437.417C438.55 109.031 439.46 108.836 440.147 108.444C440.833 108.053 441.331 107.524 441.64 106.858C441.956 106.185 442.114 105.427 442.114 104.582C442.114 103.738 441.956 102.983 441.64 102.317C441.331 101.651 440.83 101.129 440.136 100.751C439.443 100.367 438.523 100.175 437.376 100.175H432.886V119H430.332ZM452.383 119H449.706L457.45 97.9091H460.086L467.831 119H465.153L458.851 101.246H458.686L452.383 119ZM453.372 110.761H464.164V113.027H453.372V110.761ZM492.77 97.9091V119H490.299L478.806 102.44H478.6V119H476.046V97.9091H478.517L490.051 114.51H490.257V97.9091H492.77ZM500.998 97.9091H503.923L509.772 107.754H510.02L515.869 97.9091H518.794L511.173 110.308V119H508.619V110.308L500.998 97.9091Z" fill="#0369a0"/>
                <line class="hidden min-[1050px]:block" x1="316.5" y1="45.5" x2="316.5" y2="135.5" stroke="#0369a0" stroke-width="3" stroke-linecap="round"/>
            </svg>
        </div>
        <!-- Nav Links -->
        <div class="w-full">
            <div class="font-tajawal text-md text-gray-600 hidden justify-center md:flex gap-8" class:flex-row-reverse={ isCurrentLangAr }>
                <a href="#home" class="font-medium hover:text-primary transition-colors">
                    { isCurrentLangAr ? "الرئيسية" : "Home" }
                </a>    
                <a href="#what_we_offer" class="font-medium hover:text-primary transition-colors">
                    { isCurrentLangAr ? "ماذا نقدم" : "What We Offer" }
                </a>
                <a href="#training_plan" class="font-medium hover:text-primary transition-colors">
                    { isCurrentLangAr ? "خطة التدريب" : "Training Plan" }
                </a>
                <a href="#frequent_questions" class="font-medium hover:text-primary transition-colors">
                    { isCurrentLangAr ? "الاسئلة الشائعة" : "Frequently Questions" }
                </a>
            </div>
        </div>
        <!-- Change Language Button -->
        <div>
            <div 
                class="relative h-10 min-w-20 md:w-28 hidden md:flex justify-center items-center rounded-full shadow-md text-lg font-bold"
            >
                <button 
                    class={[
                        "peer/en", 
                        "z-10", 
                        "w-1/2",
                        "h-full",
                        "transition-all", 
                        "duration-200", 
                        "cursor-pointer",
                        "flex justify-center items-center",
                        isCurrentLangAr ? 'text-black' : "text-white", 
                        isCurrentLangAr ? "hover:text-white" : "hover:text-white", 
                        "peer-hover/ar:text-black",
                    ]}
                    aria-label="Change language to English"
                    onclick={() => { changeLangPref('en') }}
                >
                    <span class="translate-x-[3px] -translate-y-[1px]">
                        en
                    </span>
                </button>
                <button 
                    class={[
                        "peer/ar", 
                        "z-10", 
                        "w-1/2",
                        "h-full",
                        "transition-all", 
                        "duration-200", 
                        "cursor-pointer",
                        "flex justify-center items-center",
                        isCurrentLangAr ? 'text-white' : "text-black", 
                        isCurrentLangAr ? "hover:text-white" : "hover:text-white", 
                        "peer-hover/en:text-black",
                ]}
                    aria-label="Change language to Arabic"
                    onclick={() => { changeLangPref('ar') }}
                    >
                    <span class="-translate-x-[3px] -translate-y-[1px]">
                        ar
                    </span>
                </button>
                <span class={[
                    "absolute", 
                    isCurrentLangAr ? "left-1/2" : "left-0", 
                    "w-1/2", 
                    "h-8/10", 
                    "bg-navy-600", 
                    "rounded-full", 
                    "transition-all", 
                    "duration-200", 
                    isCurrentLangAr ? "-mx-1" : "mx-1",
                    "peer-hover/ar:left-1/2", 
                    "peer-hover/ar:-mx-1", 
                    "peer-hover/en:left-0", 
                    "peer-hover/en:mx-1"
                ]}></span>
            </div>
        </div>
        <div class="p-2 flex justify-center items-center md:hidden">
            <button class="cursor-pointer" aria-label="Toggle menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#00000095" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu">
                    <line x1="4" x2="20" y1="12" y2="12"></line>
                    <line x1="4" x2="20" y1="6" y2="6"></line>
                    <line x1="4" x2="20" y1="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </div>
</nav>


{@render children()}


<footer class="bg-navy-900 h-16 w-full flex justify-center items-center mt-10">
    <p class="text-white text-center max-w-9/10" dir={ isCurrentLangAr ? 'rtl' : 'ltr'}>
        {#if langPreference.lang == 'ar'}
            جميع الحقوق محفوظة © 2025 | برنامج الزمالة البريطانية لتقويم الأسنان.
        {:else}
            All Rights Reserved © 2025 | British Fellowship Program in Orthodontics.
        {/if}
    </p>
</footer>

<style>

</style>